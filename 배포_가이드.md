# 더비다 요양원 홈페이지 배포 가이드

> **도메인**: https://thevida.co.kr

## 🚀 빠른 배포 (Docker 사용)

### 1. 환경 변수 설정
```bash
# 이메일 설정 (Gmail 사용)
export EMAIL_USER=your-email@gmail.com
export EMAIL_PASS=your-app-password
export FRONTEND_URL=http://localhost:3000
```

### 2. Docker Compose로 배포
```bash
# 전체 시스템 실행
./deploy.sh

# 또는 수동으로 실행
docker-compose up -d
```

### 3. 접속 확인
- **프론트엔드**: http://localhost:3000
- **백엔드 API**: http://localhost:5000
- **관리자 패널**: http://localhost:3000/admin
- **관리자 계정**: admin@thevida.com / admin123

### 4. 도메인 설정 (thevida.co.kr)
```bash
# DNS 설정
# A 레코드: @ → 서버 IP 주소
# CNAME 레코드: www → thevida.co.kr
# A 레코드: api → 서버 IP 주소 (백엔드용)
```

## 🌐 클라우드 서비스 배포

### Vercel (프론트엔드)

1. **Vercel CLI 설치**
```bash
npm install -g vercel
```

2. **프로젝트 배포**
```bash
# 프로젝트 루트에서
vercel --prod
```

3. **환경 변수 설정**
- Vercel 대시보드에서 환경 변수 설정
- `REACT_APP_API_URL`: 백엔드 API URL

### Railway (백엔드)

1. **Railway CLI 설치**
```bash
npm install -g @railway/cli
```

2. **로그인 및 프로젝트 생성**
```bash
railway login
railway init
```

3. **환경 변수 설정**
```bash
railway variables set NODE_ENV=production
railway variables set MONGODB_URI_PROD=your-mongodb-uri
railway variables set JWT_SECRET=your-jwt-secret
railway variables set EMAIL_USER=your-email@gmail.com
railway variables set EMAIL_PASS=your-app-password
```

4. **배포**
```bash
railway up
```

### MongoDB Atlas (데이터베이스)

1. **클러스터 생성**
   - [MongoDB Atlas](https://www.mongodb.com/atlas) 접속
   - 새 프로젝트 생성
   - 클러스터 생성 (M0 Free 티어 권장)

2. **데이터베이스 사용자 생성**
   - Database Access → Add New Database User
   - Username과 Password 설정

3. **IP 화이트리스트 설정**
   - Network Access → Add IP Address
   - `0.0.0.0/0` (모든 IP 허용) 또는 특정 IP

4. **연결 문자열 복사**
   - Clusters → Connect → Connect your application
   - 연결 문자열을 환경 변수에 설정

## 🖥️ VPS 배포

### Ubuntu/Debian 서버

1. **서버 준비**
```bash
# 시스템 업데이트
sudo apt update && sudo apt upgrade -y

# Docker 설치
sudo apt install docker.io docker-compose nginx -y
sudo systemctl enable docker
sudo systemctl start docker

# 사용자를 docker 그룹에 추가
sudo usermod -aG docker $USER
```

2. **프로젝트 클론**
```bash
git clone <repository-url>
cd thevida
```

3. **환경 변수 설정**
```bash
# 백엔드 환경 변수
cd backend
cp env.example .env
# .env 파일 편집

# 프론트엔드 환경 변수
cd ..
cp env.example .env
# .env 파일 편집
```

4. **Docker Compose 실행**
```bash
docker-compose up -d
```

5. **Nginx 설정**
```bash
# Nginx 설정 파일 생성
sudo nano /etc/nginx/sites-available/thevida

# 메인 사이트 설정
server {
    listen 80;
    server_name thevida.co.kr www.thevida.co.kr;

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# API 서브도메인 설정
server {
    listen 80;
    server_name api.thevida.co.kr;

    location / {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# 심볼릭 링크 생성
sudo ln -s /etc/nginx/sites-available/thevida /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

6. **SSL 인증서 설정 (Let's Encrypt)**
```bash
# Certbot 설치
sudo apt install certbot python3-certbot-nginx

# SSL 인증서 발급
sudo certbot --nginx -d thevida.co.kr -d www.thevida.co.kr -d api.thevida.co.kr

# 자동 갱신 설정
sudo crontab -e
# 다음 줄 추가: 0 12 * * * /usr/bin/certbot renew --quiet
```

## 🌐 도메인 설정 가이드

### DNS 설정 (thevida.co.kr)
```bash
# A 레코드 설정
@     → 서버 IP 주소
api   → 서버 IP 주소 (백엔드 API용)

# CNAME 레코드 설정
www   → thevida.co.kr
```

### 서브도메인 구성
- **메인 사이트**: https://thevida.co.kr
- **백엔드 API**: https://api.thevida.co.kr
- **관리자 패널**: https://thevida.co.kr/admin

## 🔧 환경 변수 설정

### 백엔드 (.env)
```env
# Server Configuration
PORT=5000
NODE_ENV=production

# Database Configuration
MONGODB_URI=mongodb://localhost:27017/thevida
MONGODB_URI_PROD=mongodb+srv://username:password@cluster.mongodb.net/thevida

# JWT Configuration
JWT_SECRET=your-super-secret-jwt-key-here
JWT_EXPIRES_IN=7d

# Email Configuration (Gmail)
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-password
EMAIL_FROM=더비다 요양원 <your-email@gmail.com>

# CORS Configuration
CORS_ORIGIN=https://thevida.co.kr

# Admin Configuration
ADMIN_EMAIL=admin@thevida.com
ADMIN_PASSWORD=admin123
```

### 프론트엔드 (.env)
```env
REACT_APP_API_URL=https://api.thevida.co.kr/api
```

## 📊 모니터링 및 유지보수

### 로그 확인
```bash
# Docker 로그
docker-compose logs -f

# 특정 서비스 로그
docker-compose logs -f backend
docker-compose logs -f frontend
```

### 백업
```bash
# MongoDB 백업
docker-compose exec mongodb mongodump --out /backup

# 백업 파일 복사
docker cp thevida-mongodb:/backup ./backup
```

### 업데이트
```bash
# 코드 업데이트
git pull origin main

# 컨테이너 재빌드
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

## 🔒 보안 설정

### 방화벽 설정
```bash
# UFW 활성화
sudo ufw enable

# 필요한 포트만 허용
sudo ufw allow 22    # SSH
sudo ufw allow 80    # HTTP
sudo ufw allow 443   # HTTPS
```

### SSL/TLS 설정
- Let's Encrypt 인증서 사용
- HSTS 헤더 설정
- 강력한 암호화 스위트 사용

### 데이터베이스 보안
- 강력한 비밀번호 사용
- IP 화이트리스트 설정
- 정기적인 백업

## 🚨 문제 해결

### 일반적인 문제들

1. **포트 충돌**
```bash
# 포트 사용 확인
sudo netstat -tulpn | grep :5000
sudo netstat -tulpn | grep :3000

# 충돌하는 프로세스 종료
sudo kill -9 <PID>
```

2. **Docker 권한 문제**
```bash
# Docker 그룹에 사용자 추가
sudo usermod -aG docker $USER
newgrp docker
```

3. **메모리 부족**
```bash
# Docker 리소스 제한 설정
# docker-compose.yml에 추가
services:
  backend:
    deploy:
      resources:
        limits:
          memory: 512M
```

4. **데이터베이스 연결 실패**
```bash
# MongoDB 상태 확인
docker-compose exec mongodb mongo --eval "db.adminCommand('ping')"

# 연결 문자열 확인
echo $MONGODB_URI_PROD
```

## 📞 지원

문제가 발생하면 다음을 확인하세요:

1. **로그 확인**: `docker-compose logs -f`
2. **환경 변수 확인**: 모든 필수 환경 변수가 설정되었는지 확인
3. **네트워크 연결**: 방화벽 및 포트 설정 확인
4. **리소스 사용량**: CPU, 메모리, 디스크 사용량 확인

### 연락처
- **기술 지원**: tech@thevida.co.kr
- **긴급 상황**: 032-891-0121 (인천점)
- **웹사이트**: https://thevida.co.kr
